<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Conquête – Menu</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="center">
  <div class="hero">
    <canvas id="castle" width="560" height="160" aria-label="Animation châteaux"></canvas>
    <h1 class="title">Conquête</h1>
  </div>

  <div class="menu">
    <a class="btn primary" href="versus.html">Play</a>
    <a class="btn" href="settings.html">Settings</a>
    <div class="small">Menu avec animation • prêt pour GitHub Pages</div>
  </div>
</div>

<script>
// ===== Animation châteaux: aller-retour infini =====
(function(){
  const cv = document.getElementById('castle');
  const ctx = cv.getContext('2d');
  const W=cv.width, H=cv.height, groundY=H-24;
  const left = { x: 40, y: groundY-54, w:66, h:54 };
  const right= { x: W-106, y: groundY-54, w:66, h:54 };
  const G = 0.12; // gravité
  let shooter='L', phase='wait', t=0, boomAmp=0;
  const waitFrames = 50;
  const proj = { x:0,y:0,vx:0,vy:0,active:false };

  function line(){ ctx.strokeStyle='#2b3448'; ctx.beginPath(); ctx.moveTo(0,groundY); ctx.lineTo(W,groundY); ctx.stroke(); }
  function castle(c, side){
    ctx.fillStyle = side==='L' ? '#2f4d3d' : '#5a2e2e'; ctx.fillRect(c.x,c.y,c.w,c.h);
    ctx.fillStyle='#cfd7df'; const teeth=4, tw=c.w/teeth, th=8;
    for(let i=0;i<teeth;i++){ ctx.fillRect(c.x+i*tw+2, c.y-10, tw-4, th); }
    ctx.strokeStyle='#cfd7df'; ctx.lineWidth=2; ctx.beginPath();
    ctx.moveTo(c.x+c.w/2, c.y-18); ctx.lineTo(c.x+c.w/2, c.y-34); ctx.stroke();
    ctx.fillStyle = side==='L' ? '#7cfe9a' : '#ff7a7a'; ctx.beginPath();
    ctx.moveTo(c.x+c.w/2, c.y-34); ctx.lineTo(c.x+c.w/2+14, c.y-28); ctx.lineTo(c.x+c.w/2, c.y-22); ctx.closePath(); ctx.fill();
  }
  function explosion(cx,cy,amp){
    for(let r=0;r<3;r++){
      ctx.beginPath(); ctx.arc(cx, cy, amp - r*6, 0, Math.PI*2);
      ctx.strokeStyle = r===0?'#ffe6a6':(r===1?'#ffb37a':'#ff7a7a');
      ctx.lineWidth=2; ctx.stroke();
    }
  }
  function aimAndFire(from){
    const src = from==='L'?left:right;
    const dst = from==='L'?right:left;
    proj.x = src.x + (from==='L'?src.w-4:4);
    proj.y = src.y - 8;
    const T = 120; // frames de trajet
    const targetX = dst.x + dst.w/2;
    const targetY = dst.y + 10;
    proj.vx = (targetX - proj.x)/T;
    proj.vy = (targetY - proj.y + 0.5*G*T*T)/T;
    proj.active = true; phase='fly';
  }

  function tick(){
    ctx.clearRect(0,0,W,H);
    line(); castle(left,'L'); castle(right,'R');

    if(phase==='wait'){
      if(++t>waitFrames){ t=0; aimAndFire(shooter); }
    } else if(phase==='fly'){
      ctx.fillStyle='#d1c5a1'; ctx.beginPath(); ctx.arc(proj.x,proj.y,4,0,Math.PI*2); ctx.fill();
      proj.x += proj.vx; proj.y += proj.vy; proj.vy += G;
      // impact
      const dst = shooter==='L'?right:left;
      if(proj.x>dst.x && proj.x<dst.x+dst.w && proj.y>dst.y && proj.y<dst.y+dst.h){
        phase='boom'; boomAmp=0;
      }
    } else if(phase==='boom'){
      const dst = shooter==='L'?right:left;
      const cx = dst.x + dst.w/2, cy = dst.y + dst.h/2;
      boomAmp += 2; explosion(cx,cy,boomAmp);
      if(boomAmp>28){ // switch shooter
        shooter = shooter==='L'?'R':'L';
        phase='wait'; t=0;
      }
    }

    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>
